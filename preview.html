<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Usuários - Backend Node.js</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Hero Section -->
        <section class="text-center mb-16 animate-fade-in">
            <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6">
                Sistema de Usuários Robusto
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 mb-8 max-w-3xl mx-auto leading-relaxed">
                Um <strong>backend completo em Node.js</strong> construído com <strong>Express.js</strong> e <strong>SQLite</strong> para gerenciar usuários de forma segura e escalável. 
                Inclui registro com criptografia de senhas, autenticação JWT, CRUD de perfis e listagem protegida. 
                Perfeito para aplicações web modernas que demandam <strong>controle total sobre usuários</strong>.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="showSection('register')" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-all duration-300 shadow-lg hover:shadow-xl">
                    Testar Registro
                </button>
                <button onclick="showSection('login')" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-all duration-300 shadow-lg hover:shadow-xl">
                    Fazer Login
                </button>
            </div>
            <p class="mt-4 text-sm text-gray-500">Certifique-se de que o servidor está rodando em <strong>http://localhost:3001</strong></p>
        </section>

        <!-- Features Section -->
        <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>Registro Seguro</strong></h3>
                <p class="text-gray-600 mb-4">Crie contas de usuários com validação de email único e hashing de senhas usando <strong>bcryptjs</strong>. Evite senhas fracas com regras rigorosas de complexidade.</p>
                <ul class="space-y-2 text-sm text-gray-500">
                    <li>• Validação de formato de email</li>
                    <li>• Senha mínima de 8 caracteres</li>
                    <li>• Hash salgado para máxima segurança</li>
                </ul>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>Autenticação JWT</strong></h3>
                <p class="text-gray-600 mb-4">Gere tokens JWT stateless para sessões seguras. Tokens incluem ID e email do usuário, com expiração configurável via ambiente.</p>
                <ul class="space-y-2 text-sm text-gray-500">
                    <li>• Middleware de autenticação</li>
                    <li>• Proteção contra CSRF</li>
                    <li>• Refresh tokens opcionais</li>
                </ul>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>CRUD Completo</strong></h3>
                <p class="text-gray-600 mb-4">Gerencie perfis com operações GET, PUT e DELETE protegidas. Liste todos os usuários (sem senhas) para administradores.</p>
                <ul class="space-y-2 text-sm text-gray-500">
                    <li>• Atualização de nome e email</li>
                    <li>• Exclusão irreversível</li>
                    <li>• Logs de atividades</li>
                </ul>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>Segurança Avançada</strong></h3>
                <p class="text-gray-600 mb-4">Implementado com <strong>helmet</strong> para headers seguros, rate limiting para prevenir abusos e CORS configurado para produção.</p>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>Persistência SQLite</strong></h3>
                <p class="text-gray-600 mb-4">Banco de dados leve e rápido com transações ACID. Fácil migração para PostgreSQL ou MongoDB em escala.</p>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-4"><strong>Performance Otimizada</strong></h3>
                <p class="text-gray-600 mb-4">Consultas otimizadas, índices no banco e Express middleware para caching. Pronto para milhares de requisições por minuto.</p>
            </div>
        </section>

        <!-- Interactive Sections -->
        <div id="sections" class="space-y-8 mb-20">
            <!-- Register Section -->
            <section id="register-section" class="bg-white p-10 rounded-3xl shadow-2xl hidden animate-fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Registrar Novo Usuário</h2>
                <form id="register-form" class="max-w-md mx-auto space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                        <input type="text" id="reg-name" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="reg-email" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha (mín. 8 chars)</label>
                        <input type="password" id="reg-password" required minlength="8" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 px-8 rounded-xl font-bold text-lg transition-all duration-300 shadow-lg hover:shadow-xl">Registrar</button>
                </form>
                <p id="reg-message" class="mt-4 text-center text-green-600 hidden font-medium"></p>
            </section>

            <!-- Login Section -->
            <section id="login-section" class="bg-white p-10 rounded-3xl shadow-2xl hidden animate-fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Fazer Login</h2>
                <form id="login-form" class="max-w-md mx-auto space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="login-email" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <input type="password" id="login-password" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-4 px-8 rounded-xl font-bold text-lg transition-all duration-300 shadow-lg hover:shadow-xl">Entrar</button>
                </form>
                <p id="login-message" class="mt-4 text-center text-green-600 hidden font-medium"></p>
                <div id="token-display" class="mt-6 p-4 bg-gray-100 rounded-xl hidden">
                    <strong>Token JWT:</strong> <span id="token-value"></span>
                    <button onclick="copyToken()" class="ml-2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Copiar</button>
                </div>
            </section>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="bg-white p-10 rounded-3xl shadow-2xl hidden animate-fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Dashboard do Usuário</h2>
                <div id="profile-info" class="max-w-md mx-auto mb-8 p-6 bg-blue-50 rounded-2xl hidden">
                    <h3 class="text-2xl font-bold text-blue-800 mb-2">Perfil</h3>
                    <p><strong>Nome:</strong> <span id="profile-name"></span></p>
                    <p><strong>Email:</strong> <span id="profile-email"></span></p>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-xl font-bold mb-4">Atualizar Perfil</h4>
                        <form id="update-form" class="space-y-4">
                            <input type="text" id="update-name" placeholder="Novo nome" class="w-full p-3 border rounded-lg">
                            <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-bold">Atualizar</button>
                        </form>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold mb-4">Lista de Usuários</h4>
                        <div id="users-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-xl font-bold transition-all duration-300">Logout</button>
                    <button onclick="deleteAccount()" class="ml-4 bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-xl font-bold transition-all duration-300">Excluir Conta</button>
                </div>
            </section>
        </div>

        <!-- API Documentation -->
        <section class="bg-white p-10 rounded-3xl shadow-2xl mb-20">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Documentação das APIs</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4">Endpoints Públicos</h3>
                    <ul class="space-y-2">
                        <li><strong>POST /api/register</strong> - {name, email, password}</li>
                        <li><strong>POST /api/login</strong> - {email, password} → token</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4">Endpoints Protegidos (Authorization: Bearer &lt;token&gt;)</h3>
                    <ul class="space-y-2">
                        <li><strong>GET /api/profile</strong> - Perfil atual</li>
                        <li><strong>PUT /api/profile</strong> - Atualizar nome</li>
                        <li><strong>DELETE /api/profile</strong> - Excluir conta</li>
                        <li><strong>GET /api/users</strong> - Lista todos os usuários</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="space-y-6 mb-20">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-12">Perguntas Frequentes</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold mb-4">Como iniciar o servidor?</h3>
                    <p>Execute <strong>npm run server</strong> após <strong>npm install</strong>. O servidor fica disponível em <strong>http://localhost:3001</strong>.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold mb-4">O banco é persistente?</h3>
                    <p>Sim, usa <strong>users.db</strong> no diretório raiz. Apague o arquivo para resetar dados.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold mb-4">Como customizar JWT?</h3>
                    <p>Edite <strong>.env</strong> com <strong>JWT_SECRET=sua-chave-secreta</strong> e <strong>JWT_EXPIRES_IN=1h</strong>.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold mb-4">É responsivo?</h3>
                    <p>Todo o sistema é <strong>100% responsivo</strong> com Tailwind CSS, funcionando perfeitamente em mobile e desktop.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-xl md:col-span-2">
                    <h3 class="text-xl font-bold mb-4">Preciso de deploy?</h3>
                    <p>Sim, fácil com <strong>Vercel, Railway ou Render</strong>. SQLite funciona em serverless com ajustes mínimos.</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let currentToken = localStorage.getItem('token') || '';

        function showSection(section) {
            document.querySelectorAll('[id$="-section"]').forEach(s => s.classList.add('hidden'));
            document.getElementById(`${section}-section`).classList.remove('hidden');
            if (section === 'dashboard') loadProfile();
        }

        // Register
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            try {
                const res = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await res.json();
                document.getElementById('reg-message').textContent = data.message || 'Erro no servidor';
                document.getElementById('reg-message').classList.remove('hidden', 'text-red-600');
                document.getElementById('reg-message').classList.add(data.success ? 'text-green-600' : 'text-red-600');
            } catch (err) {
                document.getElementById('reg-message').textContent = 'Erro de conexão';
                document.getElementById('reg-message').classList.add('text-red-600', 'block');
            }
        });

        // Login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (data.token) {
                    currentToken = data.token;
                    localStorage.setItem('token', currentToken);
                    document.getElementById('token-value').textContent = currentToken;
                    document.getElementById('token-display').classList.remove('hidden');
                    document.getElementById('login-message').textContent = 'Login realizado! Token salvo.';
                    document.getElementById('login-message').classList.add('text-green-600', 'block');
                    setTimeout(() => showSection('dashboard'), 1000);
                } else {
                    document.getElementById('login-message').textContent = data.error || 'Erro no login';
                    document.getElementById('login-message').classList.add('text-red-600', 'block');
                }
            } catch (err) {
                document.getElementById('login-message').textContent = 'Erro de conexão';
                document.getElementById('login-message').classList.add('text-red-600', 'block');
            }
        });

        async function loadProfile() {
            if (!currentToken) return;
            try {
                const res = await fetch(`${API_BASE}/profile`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                if (res.ok) {
                    const profile = await res.json();
                    document.getElementById('profile-name').textContent = profile.name;
                    document.getElementById('profile-email').textContent = profile.email;
                    document.getElementById('profile-info').classList.remove('hidden');
                    loadUsers();
                }
            } catch (err) {}
        }

        async function loadUsers() {
            try {
                const res = await fetch(`${API_BASE}/users`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                if (res.ok) {
                    const users = await res.json();
                    const list = document.getElementById('users-list');
                    list.innerHTML = users.map(u => `<div class="p-3 bg-gray-100 rounded-lg"><strong>${u.name}</strong> - ${u.email}</div>`).join('');
                }
            } catch (err) {}
        }

        document.getElementById('update-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('update-name').value;
            if (!name) return;
            try {
                const res = await fetch(`${API_BASE}/profile`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ name })
                });
                if (res.ok) {
                    loadProfile();
                    alert('Perfil atualizado!');
                }
            } catch (err) {}
        });

        window.logout = () => {
            localStorage.removeItem('token');
            currentToken = '';
            showSection('login');
        };

        window.deleteAccount = async () => {
            if (confirm('Excluir conta permanentemente?')) {
                try {
                    const res = await fetch(`${API_BASE}/profile`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${currentToken}` }
                    });
                    if (res.ok) {
                        logout();
                        alert('Conta excluída!');
                    }
                } catch (err) {}
            }
        };

        function copyToken() {
            navigator.clipboard.writeText(document.getElementById('token-value').textContent);
            alert('Token copiado!');
        }

        // Auto show login if token
        if (currentToken) {
            showSection('dashboard');
        } else {
            showSection('register');
        }
    </script>
</body>
</html>